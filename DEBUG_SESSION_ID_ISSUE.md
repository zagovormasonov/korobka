# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å SessionId

## –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞:
```
SessionId –ø—É—Å—Ç–æ–π, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Å–æ–æ–±—â–µ–Ω–∏—è –º–∞—Å–∫–æ—Ç–∞
```

–ò –≤ –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ:
```
sessionId: true
```

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã

1. **SessionId –≤ –ë–î —Ä–∞–≤–µ–Ω `true` –≤–º–µ—Å—Ç–æ UUID**
2. **–ü—Ä–æ–±–ª–µ–º–∞ —Å API endpoint `/verify-token`**
3. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ useAuth —Ö—É–∫–µ**

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
```bash
cd server
node scripts/debug_session_id.js
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø–æ–∫–∞–∂–µ—Ç:
- –í—Å–µ session_id –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –ò—Ö —Ç–∏–ø—ã –∏ –∑–Ω–∞—á–µ–Ω–∏—è
- –ó–∞–ø–∏—Å–∏ —Å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º–∏ session_id

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
–ü—Ä–∏ –≤—Ö–æ–¥–µ –≤ –õ–ö –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –ª–æ–≥–∏:
```
‚úÖ [DASHBOARD] –¢–æ–∫–µ–Ω –≤–∞–ª–∏–¥–µ–Ω, sessionId: [UUID]
üîì [DASHBOARD] personal_plan_unlocked –∏–∑ –ë–î: [true/false]
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏:
```
üîÑ [DASHBOARD] useEffect –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: {
  sessionId: true,
  sessionIdValue: "actual-uuid-here",
  sessionIdType: "string",
  ...
}
```

## –†–µ—à–µ–Ω–∏—è

### –ï—Å–ª–∏ sessionId –≤ –ë–î —Ä–∞–≤–µ–Ω `true`

1. **–ù–∞–π–¥–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º–Ω—É—é –∑–∞–ø–∏—Å—å:**
```sql
SELECT * FROM primary_test_results WHERE session_id = true;
```

2. **–ò—Å–ø—Ä–∞–≤—å—Ç–µ session_id:**
```sql
UPDATE primary_test_results 
SET session_id = gen_random_uuid() 
WHERE session_id = true;
```

### –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤ API

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ `server/routes/dashboard.js` –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `/verify-token`:
- `user.session_id` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞
- –ï—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å sessionId
- –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

### –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ `src/hooks/useAuth.ts`:
- `data.sessionId` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è
- `setAuthData` –ø–æ–ª—É—á–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

## –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è, –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å fallback –≤ DashboardPage:

```typescript
// –í DashboardPage.tsx
const validSessionId = authData?.sessionId && 
  authData.sessionId !== true && 
  typeof authData.sessionId === 'string' && 
  authData.sessionId.trim() !== '';

if (!validSessionId) {
  console.error('‚ùå –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π sessionId, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –ª–æ–≥–∏–Ω');
  navigate('/lk/login');
  return;
}
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. –û—á–∏—Å—Ç–∏—Ç–µ localStorage: `localStorage.clear()`
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
3. –í–æ–π–¥–∏—Ç–µ –≤ –õ–ö –∑–∞–Ω–æ–≤–æ
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ - sessionId –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã–º UUID
