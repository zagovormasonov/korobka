# Исправление открытия PDF в Safari приватном режиме

## Проблема
В Safari на iPhone в режиме приватного просмотра PDF файлы, сгенерированные в личном кабинете, не открываются из-за ограничений безопасности `window.open()` с blob URL.

## Решение
Создана утилитарная функция `openPdf` в `src/utils/pdfUtils.ts`, которая:

1. **Определяет Safari на мобильных устройствах** - проверяет User Agent
2. **Для Safari** - использует iframe в той же вкладке с кнопкой закрытия
3. **Для других браузеров** - использует стандартное `window.open()`

## Изменения

### 1. Создан файл `src/utils/pdfUtils.ts`
- Функция `isMobileSafari()` - определение Safari на мобильных
- Функция `createPdfIframe()` - создание iframe с кнопкой закрытия
- Функция `openPdf()` - универсальное открытие PDF

### 2. Обновлен `src/pages/PersonalPlanPage.tsx`
- Импортирована утилита `openPdf`
- Заменена локальная функция на использование утилиты
- Обновлены вызовы для персонального плана и подготовки к сеансу

### 3. Обновлен `src/pages/DashboardPage.tsx`
- Импортирована утилита `openPdf`
- Упрощены функции `downloadPersonalPlan`, `downloadSessionPreparation`, `downloadPsychologistPdf`
- Удален дублированный код определения Safari

## Как это работает

### Для Safari на мобильных устройствах:
1. Создается полноэкранный iframe с PDF
2. Добавляется красная кнопка "✕ Закрыть" в правом верхнем углу
3. PDF отображается в той же вкладке
4. Пользователь может закрыть iframe кнопкой

### Для других браузеров:
1. PDF открывается в новой вкладке как обычно
2. Сохраняется привычное поведение

## Преимущества решения

✅ **Работает в Safari приватном режиме** - PDF отображается в iframe  
✅ **Обратная совместимость** - другие браузеры работают как раньше  
✅ **Удобный интерфейс** - кнопка закрытия для возврата к приложению  
✅ **Переиспользуемый код** - одна утилита для всех PDF  
✅ **Автоматическое определение** - не требует ручного выбора режима  

## Тестирование

Решение протестировано на:
- Safari на iPhone (обычный режим)
- Safari на iPhone (приватный режим) 
- Chrome на Android
- Chrome на десктопе

Все PDF файлы теперь корректно открываются в Safari приватном режиме в той же вкладке.
