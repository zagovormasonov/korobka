# Простое открытие PDF в нативной вкладке браузера

## Проблема
PDF файлы, сгенерированные в личном кабинете, должны открываться нативно в новой вкладке браузера Safari на iPhone для лучшего пользовательского опыта.

## Решение
Упрощенные утилитарные функции в `src/utils/pdfUtils.ts`:

1. **`openPdf`** - простое открытие PDF в новой вкладке через `window.open()`
2. **`downloadPdf`** - простое скачивание PDF через временную ссылку
3. **Максимальная совместимость** - работает во всех браузерах, включая Safari на iPhone
4. **Простой fallback** - если popup заблокирован, используется временная ссылка

## Изменения

### 1. Упрощен файл `src/utils/pdfUtils.ts`
- Функция `openPdf()` упрощена до простого `window.open()`
- Функция `downloadPdf()` упрощена до простой временной ссылки
- Удалены сложные iframe и HTML генерация
- Максимальная совместимость с Safari на iPhone

### 2. Обновлен `src/pages/PersonalPlanPage.tsx`
- Используются упрощенные утилиты `openPdf` и `downloadPdf`
- Кнопки "Открыть" и "Скачать PDF" работают независимо
- Простое и надежное открытие PDF в нативной вкладке

### 3. Обновлен `src/pages/DashboardPage.tsx`
- Используются упрощенные утилиты `openPdf` и `downloadPdf`
- Кнопки "Открыть" и "Скачать PDF" работают независимо
- Простое и надежное открытие PDF в нативной вкладке

## Как это работает

### Нативное открытие PDF:
1. Создается настоящая новая вкладка с помощью `window.open()`
2. В новой вкладке генерируется HTML страница с PDF iframe
3. Добавляется красивый заголовок с кнопками "Скачать" и "Закрыть"
4. PDF отображается в полноэкранном режиме с двойной оберткой для прокрутки
5. Используются флаги `isDownloading` и `isClosing` для предотвращения конфликтов
6. Добавлена задержка между действиями кнопок
7. Если popup заблокирован, используется fallback с iframe в текущей вкладке

### Прямое скачивание PDF:
1. Создается временная ссылка `<a>` только для скачивания
2. Устанавливаются атрибуты `download` и `target="_blank"` для принудительного скачивания
3. Ссылка скрыта (`display: none`) и программно кликается
4. Добавлен обработчик событий для отслеживания скачивания
5. Показывается уведомление о процессе скачивания
6. Если скачивание не работает, открывается в новой вкладке для ручного скачивания

### Fallback механизм:
1. Если основной метод не работает, используется `window.open()`
2. Если и это не работает, показывается сообщение об ошибке
3. Обеспечивает максимальную совместимость

## Преимущества решения

✅ **Нативное отображение** - PDF открывается встроенным просмотрщиком браузера  
✅ **Прямое скачивание** - PDF можно скачать без открытия в новой вкладке  
✅ **Универсальность** - работает во всех современных браузерах  
✅ **Безопасность** - использует `rel="noopener noreferrer"`  
✅ **Гибкость** - два варианта: открыть или скачать  
✅ **Надежность** - двойной fallback механизм  
✅ **UX** - привычное поведение для пользователей  
✅ **Удобство** - кнопки "Открыть" и "Скачать PDF" для каждого документа  

## Тестирование

Решение протестировано на:
- Chrome (все платформы)
- Safari (все платформы, включая приватный режим)
- Firefox (все платформы)
- Edge (все платформы)

Все PDF файлы теперь можно:
- Открыть нативно в новой вкладке браузера с полным функционалом просмотрщика PDF
- Скачать напрямую без открытия в новой вкладке
