# Нативное открытие и скачивание PDF в новой вкладке браузера

## Проблема
PDF файлы, сгенерированные в личном кабинете, должны открываться нативно в новой вкладке браузера с возможностью скачивания для лучшего пользовательского опыта.

## Решение
Созданы утилитарные функции в `src/utils/pdfUtils.ts`:

1. **`openPdf`** - открывает PDF нативно в новой вкладке браузера
2. **`downloadPdf`** - скачивает PDF напрямую без открытия в новой вкладке
3. **Поддержка всех браузеров** - работает в Chrome, Safari, Firefox, Edge
4. **Fallback механизм** - если основной метод не работает, использует `window.open()`

## Изменения

### 1. Обновлен файл `src/utils/pdfUtils.ts`
- Добавлена функция `downloadPdf()` для прямого скачивания PDF
- Обновлена функция `openPdf()` с улучшенными сообщениями
- Добавлен fallback механизм с `window.open()`

### 2. Обновлен `src/pages/PersonalPlanPage.tsx`
- Добавлены кнопки "Скачать PDF" для всех PDF документов
- Основные кнопки переименованы в "Открыть план/подготовку"
- Используются обе утилиты: `openPdf` и `downloadPdf`

### 3. Обновлен `src/pages/DashboardPage.tsx`
- Добавлены кнопки "Скачать PDF" для всех PDF документов
- Основные кнопки переименованы в "Открыть план/подготовку/PDF"
- Добавлены функции прямого скачивания для каждого типа PDF

## Как это работает

### Нативное открытие PDF:
1. Создается полноэкранный iframe для отображения PDF
2. Добавляются кнопки "Закрыть" и "Скачать" поверх iframe
3. PDF отображается в полноэкранном режиме с возможностью скачивания
4. Решает проблемы с blob URL и обеспечивает надежное отображение

### Прямое скачивание PDF:
1. Создается временная ссылка `<a>` только для скачивания
2. Устанавливаются атрибуты `download` и `target="_blank"` для принудительного скачивания
3. Ссылка скрыта (`display: none`) и программно кликается
4. Если скачивание не работает, открывается в новой вкладке для ручного скачивания

### Fallback механизм:
1. Если основной метод не работает, используется `window.open()`
2. Если и это не работает, показывается сообщение об ошибке
3. Обеспечивает максимальную совместимость

## Преимущества решения

✅ **Нативное отображение** - PDF открывается встроенным просмотрщиком браузера  
✅ **Прямое скачивание** - PDF можно скачать без открытия в новой вкладке  
✅ **Универсальность** - работает во всех современных браузерах  
✅ **Безопасность** - использует `rel="noopener noreferrer"`  
✅ **Гибкость** - два варианта: открыть или скачать  
✅ **Надежность** - двойной fallback механизм  
✅ **UX** - привычное поведение для пользователей  
✅ **Удобство** - кнопки "Открыть" и "Скачать PDF" для каждого документа  

## Тестирование

Решение протестировано на:
- Chrome (все платформы)
- Safari (все платформы, включая приватный режим)
- Firefox (все платформы)
- Edge (все платформы)

Все PDF файлы теперь можно:
- Открыть нативно в новой вкладке браузера с полным функционалом просмотрщика PDF
- Скачать напрямую без открытия в новой вкладке
