# Реализация последовательной генерации документов

## Требования
1. **Последовательная генерация** - персональный план → подготовка к сеансу → PDF для психолога
2. **Проверка на дублирование** - не генерировать повторно
3. **Полноэкранный прелоадер** с информацией о времени (до 7 минут)
4. **Фоновая работа** - продолжается при закрытии вкладки

## Реализованные изменения

### 1. GenerationAnimation.tsx - улучшенный прелоадер
**Добавлено:**
- Информация о времени генерации (до 7 минут)
- Объяснение последовательности генерации
- Улучшенный дизайн с информационными блоками

### 2. server/routes/background-generation.js - последовательная генерация
**Изменения:**
- Проверка статуса генерации перед запуском
- Последовательная генерация документов
- Проверка на дублирование каждого документа
- Логирование каждого этапа

**Логика:**
1. Проверяем, не запущена ли уже генерация
2. Генерируем персональный план (если не сгенерирован)
3. Генерируем подготовку к сеансу на основе персонального плана
4. Генерируем PDF для психолога на основе подготовки к сеансу
5. Отмечаем завершение генерации

### 3. DashboardPage.tsx - умная проверка статуса
**Добавлено:**
- Проверка статуса генерации перед запуском
- Обработка уже запущенной генерации
- Обработка уже завершенной генерации
- Улучшенный мониторинг с логированием
- Увеличенный таймаут до 10 минут

**Логика:**
1. Проверяем текущий статус генерации
2. Если завершена - перенаправляем на персональный план
3. Если запущена - показываем анимацию с текущим прогрессом
4. Если не запущена - запускаем новую генерацию

## Ключевые особенности

### ✅ Последовательная генерация
- Персональный план создается первым
- Подготовка к сеансу использует содержимое персонального плана
- PDF для психолога использует содержимое подготовки к сеансу

### ✅ Защита от дублирования
- Проверка статуса перед запуском
- Проверка каждого документа перед генерацией
- Логирование всех проверок

### ✅ Полноэкранный прелоадер
- Информация о времени генерации (до 7 минут)
- Объяснение последовательности
- Возможность закрыть вкладку

### ✅ Фоновая работа
- Генерация продолжается на сервере
- Мониторинг статуса каждые 3 секунды
- Автоматическое перенаправление при завершении

## Результат

Теперь система:
- ✅ **Генерирует документы последовательно** с учетом предыдущих
- ✅ **Не дублирует генерацию** при повторных нажатиях
- ✅ **Показывает информативный прелоадер** с временными рамками
- ✅ **Работает в фоне** даже при закрытии вкладки
- ✅ **Автоматически перенаправляет** при завершении

## Тестирование

1. Пройдите все тесты
2. Нажмите "Перейти к персональному плану"
3. Убедитесь, что показывается прелоадер с информацией о времени
4. Закройте вкладку и откройте заново - генерация должна продолжаться
5. Проверьте, что при повторном нажатии не запускается новая генерация
