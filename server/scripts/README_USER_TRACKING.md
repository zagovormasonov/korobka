# Изменения для отслеживания пользователей с начала теста

## Что изменилось

Теперь пользователи попадают в список и в базу данных **даже когда просто начинают тест**, а не только после завершения.

## Изменения в Supabase

### 1. Выполните SQL скрипт

Откройте Supabase SQL Editor и выполните скрипт:

```sql
-- Файл: server/scripts/make_answers_nullable.sql
ALTER TABLE primary_test_results 
ALTER COLUMN answers DROP NOT NULL;
```

Это сделает поле `answers` необязательным, чтобы можно было создавать запись при начале теста (когда ответов ещё нет).

## Как это работает

1. **При начале теста** (`test_start` событие):
   - Создаётся запись в `primary_test_results` с `answers = NULL`
   - Пользователь сразу появляется в списке пользователей в CMS
   - Никнейм будет "Аноним" до тех пор, пока пользователь не завершит тест

2. **При завершении теста** (`/api/tests/primary/submit`):
   - Запись обновляется: заполняется `answers`, генерируются `dashboard_token` и `dashboard_password`
   - Никнейм может быть установлен, если пользователь его указал

## Изменения в коде

- **`server/routes/analytics.js`**: Добавлена логика создания записи в `primary_test_results` при событии `test_start`
- **`src/pages/CMSPage.tsx`**: Исправлены типы TypeScript (убраны `any`, добавлены интерфейсы)

## Проверка

После выполнения SQL скрипта:
1. Откройте тест на сайте
2. Нажмите "Начать тест"
3. Проверьте в CMS раздел "Пользователи" - должен появиться новый пользователь с ником "Аноним"

